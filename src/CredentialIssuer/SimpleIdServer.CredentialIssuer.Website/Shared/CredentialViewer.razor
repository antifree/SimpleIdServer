@using SimpleIdServer.CredentialIssuer.Domains;
@using SimpleIdServer.CredentialIssuer.Website.Stores.CredentialIssuer;
@using System.Globalization;

<RadzenCard Variant="Variant.Filled" Style="@string.Join(';', innerCssStyles)">
    <RadzenStack Orientation="Orientation.Horizontal" Gap="1rem" Class="rz-p-4">
        <RadzenImage Path="@picture" Style="Width: 60px" />
        <RadzenStack Gap="0">
            <RadzenText TextStyle="TextStyle.DisplayH6">@(display == null ? CredentialConfiguration.ServerId : display.Name)</RadzenText>
            @if (display != null)
            {
                <RadzenText TextStyle="TextStyle.Body1">@display.Description</RadzenText>
            }
        </RadzenStack>
    </RadzenStack>
    <RadzenStack JustifyContent="JustifyContent.End" Orientation="Orientation.Horizontal">
        @if (ActionsContent != null)
        {
            @ActionsContent
        }
    </RadzenStack>
</RadzenCard>

@code {
    [Parameter]
    public CredentialConfiguration CredentialConfiguration { get; set; }
    [Parameter]
    public string Language { get; set; }
    [Parameter]
    public RenderFragment ActionsContent { get; set; }


    string picture { get; set; }
    string innerCssStyles { get; set; }
    CredentialConfigurationTranslation display { get; set; }

    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        if (CredentialConfiguration == null || string.IsNullOrWhiteSpace(Language)) return;
        display = GetDisplay();
        picture = display?.LogoUrl ?? "_content/SimpleIdServer.CredentialIssuer.Website/images/wallet.svg";
        var cssStyles = new List<string>
        {
            "overflow:hidden"
        };
        if (!string.IsNullOrWhiteSpace(display?.TextColor))
            cssStyles.Add($"color:{display.TextColor}");
        if (!string.IsNullOrWhiteSpace(display?.BackgroundColor))
            cssStyles.Add($"background-color:{display.BackgroundColor}");
        innerCssStyles = string.Join(";", cssStyles);
    }

    CredentialConfigurationTranslation GetDisplay()
    {
        if (CredentialConfiguration.Displays == null) return null;
        var display = CredentialConfiguration.Displays.SingleOrDefault(d => d.Locale == Language);
        return display;
    }
}